import{_ as q}from"./AuthenticatedLayout-DJ1yYA2u.js";import{B as C,k as h,r as m,z as D,c as o,o as r,a as x,u as p,m as M,w as T,d as s,e as _,F as w,f as j,t as l,n as b,s as $,W as B}from"./app-CmYmw4sZ.js";const L={class:"py-12 bg-gray-50 min-h-screen flex flex-col items-center"},Q={class:"w-full max-w-3xl bg-white shadow-md rounded-lg p-6"},V={key:0,class:"text-gray-500 text-center py-4"},W={key:1},F={class:"flex-1 px-4"},K={class:"font-semibold"},O={class:"text-gray-600 text-sm"},P={class:"pr-4"},z={class:"font-semibold"},A={class:"mt-4 flex justify-between font-semibold text-lg"},E={class:"grid grid-cols-2 gap-3"},J={key:0,class:"mt-6 bg-gray-100 p-4 rounded-lg"},U={class:"text-gray-600"},G=["value"],H={key:1,class:"mt-6 text-center"},X=["src"],Y={key:0,class:"text-red-500 mt-2"},Z={class:"left-0 w-full bg-white shadow-inner p-4 flex justify-between items-center max-w-3xl mx-auto"},ee={class:"text-lg font-semibold"},oe={__name:"Payment",props:{returnRoute:{type:String,default:null}},setup(te){const k=C(),v=h(()=>k.props.auth.user),I=e=>e?e.startsWith("http")||e.startsWith("/storage/")?e:`/storage/${e}`:"/images/default.png",i=m([]),n=m("cash"),d=m(0),f=m(""),c=h(()=>i.value.reduce((e,t)=>e+t.quantity*t.selling_price,0)),g=h(()=>d.value-c.value),u=e=>"Rp "+(parseInt(e.toString().replace(/[^\d]/g,""))||0).toLocaleString("id-ID"),S=e=>{const t=e.target.value.replace(/[^\d]/g,"");d.value=parseInt(t)||0,f.value=u(t)};D(()=>{const e=localStorage.getItem("order");e&&(i.value=JSON.parse(e))});function y(e){n.value=e,e!=="cash"&&(d.value=0,f.value="")}const R=()=>v.value.role_id===2?route("owner.invoice"):route("employee.invoice"),N=async()=>{if(!i.value.length)return alert("Tidak ada pesanan.");if(n.value==="cash"&&g.value<0)return alert("Uang diterima kurang.");try{const e=`INV-${Date.now().toString().slice(-8)}`;await $.post("/cashier/checkout",{order:i.value,payment_method:n.value,invoice_number:e});const t={items:i.value,totalPrice:c.value,receivedAmount:d.value,change:g.value,paymentMethod:n.value,date:new Date().toLocaleString("id-ID"),invoiceNumber:e};localStorage.setItem("invoiceData",JSON.stringify(t)),localStorage.removeItem("order"),B.get(R())}catch(e){console.error(e),alert("Gagal memproses pembayaran.")}};return(e,t)=>(r(),o(w,null,[x(p(M),{title:"Pembayaran"}),x(q,null,{default:T(()=>[s("div",L,[s("div",Q,[t[6]||(t[6]=s("h3",{class:"text-xl font-semibold mb-4"},"Ringkasan Pesanan",-1)),i.value.length===0?(r(),o("div",V," Tidak ada pesanan. ")):(r(),o("div",W,[(r(!0),o(w,null,j(i.value,a=>(r(),o("div",{key:a.id,class:"flex items-center bg-gray-100 rounded-lg mb-3 overflow-hidden"},[s("div",F,[s("h4",K,l(a.name),1),s("p",O,l(a.quantity)+" x Rp "+l(Number(a.selling_price).toLocaleString()),1)]),s("div",P,[s("p",z,l(u(a.quantity*a.selling_price)),1)])]))),128)),s("div",A,[t[3]||(t[3]=s("span",null,"Total",-1)),s("span",null,l(u(p(c))),1)]),t[5]||(t[5]=s("h3",{class:"mt-6 mb-2 text-lg font-semibold"},"Metode Pembayaran",-1)),s("div",E,[s("button",{onClick:t[0]||(t[0]=a=>y("cash")),class:b([n.value==="cash"?"bg-purple-600 text-white":"bg-white text-gray-700 hover:bg-gray-100","flex items-center justify-center p-4 rounded-lg shadow"])}," Tunai ",2),s("button",{onClick:t[1]||(t[1]=a=>y("qris")),class:b([n.value==="qris"?"bg-purple-600 text-white":"bg-white text-gray-700 hover:bg-gray-100","flex items-center justify-center p-4 rounded-lg shadow"])}," QRIS ",2)]),n.value==="cash"?(r(),o("div",J,[t[4]||(t[4]=s("h4",{class:"font-medium mb-2"},"Kalkulator Tunai",-1)),s("p",U,"Total: "+l(u(p(c))),1),s("input",{type:"text",value:f.value,onInput:S,placeholder:"Masukkan uang diterima",class:"mt-2 w-full border rounded-lg p-2"},null,40,G),s("p",{class:b(["mt-2 font-semibold",g.value<0?"text-red-600":"text-green-600"])}," Kembalian: "+l(u(g.value)),3)])):_("",!0),n.value==="qris"?(r(),o("div",H,[s("img",{src:I(v.value.qris_photo),alt:"QRIS Code",class:"mx-auto w-60 rounded-lg shadow",onError:t[2]||(t[2]=a=>a.target.src="/images/Qris.jpg")},null,40,X),v.value.qris_photo?_("",!0):(r(),o("p",Y,"Owner belum mengunggah foto QRIS."))])):_("",!0),s("div",Z,[s("span",ee,l(u(p(c))),1),s("button",{onClick:N,class:"bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition"}," Konfirmasi Pembayaran ")])]))])])]),_:1})],64))}};export{oe as default};
